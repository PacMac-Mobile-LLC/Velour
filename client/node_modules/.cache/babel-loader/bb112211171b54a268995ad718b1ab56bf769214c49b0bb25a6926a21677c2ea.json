{"ast":null,"code":"import _objectSpread from\"/Users/matty/VideoChat/VideoChat/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useEffect,useState}from'react';import{useAuth0}from'@auth0/auth0-react';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";const Auth0Context=/*#__PURE__*/createContext();export const useAuth0Context=()=>{const context=useContext(Auth0Context);if(!context){throw new Error('useAuth0Context must be used within an Auth0ContextProvider');}return context;};export const Auth0ContextProvider=_ref=>{let{children}=_ref;const{user,isAuthenticated,isLoading,getAccessTokenSilently,error}=useAuth0();const[userProfile,setUserProfile]=useState(null);const[loading,setLoading]=useState(true);// Configure axios with Auth0 token\nuseEffect(()=>{const configureAxios=async()=>{if(isAuthenticated&&user){try{var _user$name;const token=await getAccessTokenSilently();axios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);// Create user profile from Auth0 user\nconst profile={id:user.sub,username:user.nickname||((_user$name=user.name)===null||_user$name===void 0?void 0:_user$name.replace(/\\s+/g,'').toLowerCase())||'user',email:user.email,displayName:user.name||user.nickname||'User',picture:user.picture,role:'subscriber',// Default role\nprovider:'twitter',// Since we're using Twitter\ncreatedAt:new Date().toISOString()};setUserProfile(profile);// Store in localStorage for persistence\nlocalStorage.setItem('velour_user',JSON.stringify(profile));localStorage.setItem('velour_token',token);}catch(error){console.error('Error getting access token:',error);}}else{// Clear auth data when not authenticated\ndelete axios.defaults.headers.common['Authorization'];setUserProfile(null);localStorage.removeItem('velour_user');localStorage.removeItem('velour_token');}setLoading(false);};configureAxios();},[isAuthenticated,user,getAccessTokenSilently]);// Load user from localStorage on app start\nuseEffect(()=>{const savedUser=localStorage.getItem('velour_user');const savedToken=localStorage.getItem('velour_token');if(savedUser&&savedToken&&!isAuthenticated){try{const userData=JSON.parse(savedUser);setUserProfile(userData);axios.defaults.headers.common['Authorization']=\"Bearer \".concat(savedToken);}catch(error){console.error('Error loading saved user:',error);localStorage.removeItem('velour_user');localStorage.removeItem('velour_token');}}setLoading(false);},[]);const value={user:userProfile,isAuthenticated:isAuthenticated||!!userProfile,loading:isLoading||loading,error,// Auth0 specific methods\ngetAccessTokenSilently,// User profile methods\nupdateUserProfile:updates=>{if(userProfile){const updatedProfile=_objectSpread(_objectSpread({},userProfile),updates);setUserProfile(updatedProfile);localStorage.setItem('velour_user',JSON.stringify(updatedProfile));}}};return/*#__PURE__*/_jsx(Auth0Context.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useAuth0","axios","jsx","_jsx","Auth0Context","useAuth0Context","context","Error","Auth0ContextProvider","_ref","children","user","isAuthenticated","isLoading","getAccessTokenSilently","error","userProfile","setUserProfile","loading","setLoading","configureAxios","_user$name","token","defaults","headers","common","concat","profile","id","sub","username","nickname","name","replace","toLowerCase","email","displayName","picture","role","provider","createdAt","Date","toISOString","localStorage","setItem","JSON","stringify","console","removeItem","savedUser","getItem","savedToken","userData","parse","value","updateUserProfile","updates","updatedProfile","_objectSpread","Provider"],"sources":["/Users/matty/VideoChat/VideoChat/client/src/contexts/Auth0Context.js"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from 'react';\nimport { useAuth0 } from '@auth0/auth0-react';\nimport axios from 'axios';\n\nconst Auth0Context = createContext();\n\nexport const useAuth0Context = () => {\n  const context = useContext(Auth0Context);\n  if (!context) {\n    throw new Error('useAuth0Context must be used within an Auth0ContextProvider');\n  }\n  return context;\n};\n\nexport const Auth0ContextProvider = ({ children }) => {\n  const { \n    user, \n    isAuthenticated, \n    isLoading, \n    getAccessTokenSilently,\n    error \n  } = useAuth0();\n  \n  const [userProfile, setUserProfile] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  // Configure axios with Auth0 token\n  useEffect(() => {\n    const configureAxios = async () => {\n      if (isAuthenticated && user) {\n        try {\n          const token = await getAccessTokenSilently();\n          axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n          \n          // Create user profile from Auth0 user\n          const profile = {\n            id: user.sub,\n            username: user.nickname || user.name?.replace(/\\s+/g, '').toLowerCase() || 'user',\n            email: user.email,\n            displayName: user.name || user.nickname || 'User',\n            picture: user.picture,\n            role: 'subscriber', // Default role\n            provider: 'twitter', // Since we're using Twitter\n            createdAt: new Date().toISOString()\n          };\n          \n          setUserProfile(profile);\n          \n          // Store in localStorage for persistence\n          localStorage.setItem('velour_user', JSON.stringify(profile));\n          localStorage.setItem('velour_token', token);\n          \n        } catch (error) {\n          console.error('Error getting access token:', error);\n        }\n      } else {\n        // Clear auth data when not authenticated\n        delete axios.defaults.headers.common['Authorization'];\n        setUserProfile(null);\n        localStorage.removeItem('velour_user');\n        localStorage.removeItem('velour_token');\n      }\n      \n      setLoading(false);\n    };\n\n    configureAxios();\n  }, [isAuthenticated, user, getAccessTokenSilently]);\n\n  // Load user from localStorage on app start\n  useEffect(() => {\n    const savedUser = localStorage.getItem('velour_user');\n    const savedToken = localStorage.getItem('velour_token');\n    \n    if (savedUser && savedToken && !isAuthenticated) {\n      try {\n        const userData = JSON.parse(savedUser);\n        setUserProfile(userData);\n        axios.defaults.headers.common['Authorization'] = `Bearer ${savedToken}`;\n      } catch (error) {\n        console.error('Error loading saved user:', error);\n        localStorage.removeItem('velour_user');\n        localStorage.removeItem('velour_token');\n      }\n    }\n    \n    setLoading(false);\n  }, []);\n\n  const value = {\n    user: userProfile,\n    isAuthenticated: isAuthenticated || !!userProfile,\n    loading: isLoading || loading,\n    error,\n    // Auth0 specific methods\n    getAccessTokenSilently,\n    // User profile methods\n    updateUserProfile: (updates) => {\n      if (userProfile) {\n        const updatedProfile = { ...userProfile, ...updates };\n        setUserProfile(updatedProfile);\n        localStorage.setItem('velour_user', JSON.stringify(updatedProfile));\n      }\n    }\n  };\n\n  return (\n    <Auth0Context.Provider value={value}>\n      {children}\n    </Auth0Context.Provider>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}