{"ast":null,"code":"import _taggedTemplateLiteral from\"/Users/matty/VideoChat/VideoChat/client/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6,_templateObject7,_templateObject8,_templateObject9,_templateObject0,_templateObject1,_templateObject10,_templateObject11,_templateObject12,_templateObject13,_templateObject14,_templateObject15,_templateObject16,_templateObject17,_templateObject18,_templateObject19,_templateObject20,_templateObject21,_templateObject22,_templateObject23,_templateObject24,_templateObject25,_templateObject26,_templateObject27,_templateObject28,_templateObject29,_templateObject30,_templateObject31,_templateObject32,_templateObject33,_templateObject34,_templateObject35,_templateObject36,_templateObject37;import React,{useState,useEffect,useRef,useCallback}from'react';import{useParams,useSearchParams,useNavigate}from'react-router-dom';import io from'socket.io-client';import styled from'styled-components';import{Mic,MicOff,Video,VideoOff,Monitor,MessageSquare,Phone,Users,Send,Share2,Copy,Check}from'lucide-react';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Container=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  min-height: 100vh;\\n  background: #1a1a1a;\\n  display: flex;\\n  flex-direction: column;\\n\"])));const Header=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  background: #2d2d2d;\\n  padding: 15px 20px;\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  color: white;\\n\"])));const RoomInfo=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  display: flex;\\n  align-items: center;\\n  gap: 10px;\\n\"])));const RoomId=styled.span(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  font-weight: 600;\\n  font-size: 1.1rem;\\n\"])));const MainContent=styled.div(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  flex: 1;\\n  display: flex;\\n  position: relative;\\n\"])));const VideoGrid=styled.div(_templateObject6||(_templateObject6=_taggedTemplateLiteral([\"\\n  flex: 1;\\n  display: grid;\\n  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\\n  gap: 10px;\\n  padding: 20px;\\n  align-content: start;\\n\"])));const VideoContainer=styled.div(_templateObject7||(_templateObject7=_taggedTemplateLiteral([\"\\n  position: relative;\\n  background: #333;\\n  border-radius: 10px;\\n  overflow: hidden;\\n  aspect-ratio: 16/9;\\n  min-height: 200px;\\n  border: \",\";\\n  transition: border-color 0.3s ease;\\n  box-shadow: \",\";\\n\"])),props=>props.isActiveSpeaker?'3px solid #667eea':'3px solid transparent',props=>props.isActiveSpeaker?'0 0 20px rgba(102, 126, 234, 0.5)':'none');const StyledVideo=styled.video(_templateObject8||(_templateObject8=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 100%;\\n  object-fit: cover;\\n\"])));const VideoLabel=styled.div(_templateObject9||(_templateObject9=_taggedTemplateLiteral([\"\\n  position: absolute;\\n  bottom: 10px;\\n  left: 10px;\\n  background: rgba(0, 0, 0, 0.7);\\n  color: white;\\n  padding: 5px 10px;\\n  border-radius: 5px;\\n  font-size: 0.9rem;\\n\"])));const ChatPanel=styled.div(_templateObject0||(_templateObject0=_taggedTemplateLiteral([\"\\n  width: 350px;\\n  background: #2d2d2d;\\n  display: flex;\\n  flex-direction: column;\\n  border-left: 1px solid #444;\\n  \\n  @media (max-width: 768px) {\\n    position: fixed;\\n    top: 0;\\n    right: 0;\\n    height: 100vh;\\n    width: 100vw;\\n    z-index: 1000;\\n    border-left: none;\\n  }\\n\"])));const ChatHeader=styled.div(_templateObject1||(_templateObject1=_taggedTemplateLiteral([\"\\n  padding: 15px 20px;\\n  border-bottom: 1px solid #444;\\n  color: white;\\n  font-weight: 600;\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n\"])));const CloseButton=styled.button(_templateObject10||(_templateObject10=_taggedTemplateLiteral([\"\\n  background: none;\\n  border: none;\\n  color: white;\\n  font-size: 1.5rem;\\n  cursor: pointer;\\n  padding: 5px;\\n  display: none;\\n  \\n  @media (max-width: 768px) {\\n    display: block;\\n  }\\n\"])));const ChatMessages=styled.div(_templateObject11||(_templateObject11=_taggedTemplateLiteral([\"\\n  flex: 1;\\n  padding: 15px;\\n  overflow-y: auto;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 10px;\\n\"])));const Message=styled.div(_templateObject12||(_templateObject12=_taggedTemplateLiteral([\"\\n  background: \",\";\\n  color: white;\\n  padding: 10px 15px;\\n  border-radius: 10px;\\n  max-width: 80%;\\n  align-self: \",\";\\n  word-wrap: break-word;\\n\"])),props=>props.isOwn?'#667eea':'#444',props=>props.isOwn?'flex-end':'flex-start');const MessageSender=styled.div(_templateObject13||(_templateObject13=_taggedTemplateLiteral([\"\\n  font-size: 0.8rem;\\n  opacity: 0.7;\\n  margin-bottom: 5px;\\n\"])));const ChatInput=styled.div(_templateObject14||(_templateObject14=_taggedTemplateLiteral([\"\\n  padding: 15px;\\n  border-top: 1px solid #444;\\n  display: flex;\\n  gap: 10px;\\n\"])));const MessageInput=styled.input(_templateObject15||(_templateObject15=_taggedTemplateLiteral([\"\\n  flex: 1;\\n  padding: 10px 15px;\\n  border: 1px solid #555;\\n  border-radius: 20px;\\n  background: #333;\\n  color: white;\\n  font-size: 0.9rem;\\n\\n  &:focus {\\n    outline: none;\\n    border-color: #667eea;\\n  }\\n\\n  &::placeholder {\\n    color: #999;\\n  }\\n\"])));const SendButton=styled.button(_templateObject16||(_templateObject16=_taggedTemplateLiteral([\"\\n  background: #667eea;\\n  border: none;\\n  border-radius: 50%;\\n  width: 40px;\\n  height: 40px;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  color: white;\\n  cursor: pointer;\\n  transition: background 0.3s ease;\\n\\n  &:hover {\\n    background: #5a6fd8;\\n  }\\n\"])));const Controls=styled.div(_templateObject17||(_templateObject17=_taggedTemplateLiteral([\"\\n  background: #2d2d2d;\\n  padding: 20px;\\n  display: flex;\\n  justify-content: center;\\n  gap: 15px;\\n  border-top: 1px solid #444;\\n\"])));const ControlButton=styled.button(_templateObject18||(_templateObject18=_taggedTemplateLiteral([\"\\n  background: \",\";\\n  border: none;\\n  border-radius: 50%;\\n  width: 50px;\\n  height: 50px;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  color: white;\\n  cursor: pointer;\\n  transition: all 0.3s ease;\\n\\n  &:hover {\\n    background: \",\";\\n  }\\n\\n  &.leave {\\n    background: #dc3545;\\n    \\n    &:hover {\\n      background: #c82333;\\n    }\\n  }\\n\"])),props=>props.active?'#667eea':'#444',props=>props.active?'#5a6fd8':'#555');const ShareModal=styled.div(_templateObject19||(_templateObject19=_taggedTemplateLiteral([\"\\n  position: fixed;\\n  top: 0;\\n  left: 0;\\n  right: 0;\\n  bottom: 0;\\n  background: rgba(0, 0, 0, 0.8);\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  z-index: 2000;\\n\"])));const ShareModalContent=styled.div(_templateObject20||(_templateObject20=_taggedTemplateLiteral([\"\\n  background: #2d2d2d;\\n  border-radius: 15px;\\n  padding: 30px;\\n  max-width: 500px;\\n  width: 90%;\\n  color: white;\\n\"])));const ShareModalHeader=styled.div(_templateObject21||(_templateObject21=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  margin-bottom: 20px;\\n\"])));const ShareModalTitle=styled.h3(_templateObject22||(_templateObject22=_taggedTemplateLiteral([\"\\n  margin: 0;\\n  font-size: 1.3rem;\\n  color: white;\\n\"])));const CloseModalButton=styled.button(_templateObject23||(_templateObject23=_taggedTemplateLiteral([\"\\n  background: none;\\n  border: none;\\n  color: white;\\n  font-size: 1.5rem;\\n  cursor: pointer;\\n  padding: 5px;\\n  \\n  &:hover {\\n    opacity: 0.7;\\n  }\\n\"])));const ShareSection=styled.div(_templateObject24||(_templateObject24=_taggedTemplateLiteral([\"\\n  margin-bottom: 20px;\\n\"])));const ShareLabel=styled.label(_templateObject25||(_templateObject25=_taggedTemplateLiteral([\"\\n  display: block;\\n  margin-bottom: 10px;\\n  font-weight: 600;\\n  color: #ccc;\\n\"])));const ShareInputContainer=styled.div(_templateObject26||(_templateObject26=_taggedTemplateLiteral([\"\\n  display: flex;\\n  gap: 10px;\\n  align-items: center;\\n\"])));const ShareInput=styled.input(_templateObject27||(_templateObject27=_taggedTemplateLiteral([\"\\n  flex: 1;\\n  padding: 12px 15px;\\n  border: 1px solid #555;\\n  border-radius: 8px;\\n  background: #333;\\n  color: white;\\n  font-size: 0.9rem;\\n  \\n  &:focus {\\n    outline: none;\\n    border-color: #667eea;\\n  }\\n\"])));const CopyButton=styled.button(_templateObject28||(_templateObject28=_taggedTemplateLiteral([\"\\n  background: #667eea;\\n  border: none;\\n  color: white;\\n  padding: 12px 15px;\\n  border-radius: 8px;\\n  cursor: pointer;\\n  display: flex;\\n  align-items: center;\\n  gap: 8px;\\n  font-weight: 600;\\n  transition: all 0.3s ease;\\n  \\n  &:hover {\\n    background: #5a6fd8;\\n  }\\n  \\n  &:disabled {\\n    background: #28a745;\\n    cursor: not-allowed;\\n  }\\n\"])));const ShareInstructions=styled.div(_templateObject29||(_templateObject29=_taggedTemplateLiteral([\"\\n  background: rgba(102, 126, 234, 0.1);\\n  border: 1px solid rgba(102, 126, 234, 0.3);\\n  border-radius: 8px;\\n  padding: 15px;\\n  margin-top: 15px;\\n\"])));const ShareInstructionsText=styled.p(_templateObject30||(_templateObject30=_taggedTemplateLiteral([\"\\n  margin: 0;\\n  font-size: 0.9rem;\\n  color: #ccc;\\n  line-height: 1.4;\\n\"])));// Name Entry Modal Components\nconst NameModal=styled.div(_templateObject31||(_templateObject31=_taggedTemplateLiteral([\"\\n  position: fixed;\\n  top: 0;\\n  left: 0;\\n  right: 0;\\n  bottom: 0;\\n  background: rgba(0, 0, 0, 0.8);\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  z-index: 1000;\\n\"])));const NameModalContent=styled.div(_templateObject32||(_templateObject32=_taggedTemplateLiteral([\"\\n  background: white;\\n  border-radius: 12px;\\n  padding: 32px;\\n  max-width: 400px;\\n  width: 90%;\\n  text-align: center;\\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\\n\"])));const NameModalHeader=styled.div(_templateObject33||(_templateObject33=_taggedTemplateLiteral([\"\\n  margin-bottom: 24px;\\n\"])));const NameModalTitle=styled.h2(_templateObject34||(_templateObject34=_taggedTemplateLiteral([\"\\n  margin: 0 0 8px 0;\\n  color: #333;\\n  font-size: 24px;\\n  font-weight: 600;\\n\"])));const NameModalSubtitle=styled.p(_templateObject35||(_templateObject35=_taggedTemplateLiteral([\"\\n  margin: 0;\\n  color: #666;\\n  font-size: 16px;\\n\"])));const NameInput=styled.input(_templateObject36||(_templateObject36=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  padding: 12px 16px;\\n  border: 2px solid #e1e5e9;\\n  border-radius: 8px;\\n  font-size: 16px;\\n  margin-bottom: 20px;\\n  box-sizing: border-box;\\n  transition: border-color 0.2s;\\n\\n  &:focus {\\n    outline: none;\\n    border-color: #007bff;\\n  }\\n\"])));const NameModalButton=styled.button(_templateObject37||(_templateObject37=_taggedTemplateLiteral([\"\\n  background: #007bff;\\n  color: white;\\n  border: none;\\n  padding: 12px 24px;\\n  border-radius: 8px;\\n  font-size: 16px;\\n  font-weight: 600;\\n  cursor: pointer;\\n  transition: background-color 0.2s;\\n  width: 100%;\\n\\n  &:hover {\\n    background: #0056b3;\\n  }\\n\\n  &:disabled {\\n    background: #ccc;\\n    cursor: not-allowed;\\n  }\\n\"])));const VideoRoom=()=>{const{roomId}=useParams();const[searchParams]=useSearchParams();const navigate=useNavigate();console.log('VideoRoom component rendering, roomId:',roomId);const[socket,setSocket]=useState(null);const[localStream,setLocalStream]=useState(null);const[remoteStreams,setRemoteStreams]=useState(new Map());const[isAudioMuted,setIsAudioMuted]=useState(false);const[isVideoMuted,setIsVideoMuted]=useState(false);const[isScreenSharing,setIsScreenSharing]=useState(false);const[showChat,setShowChat]=useState(false);const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState('');const[participants,setParticipants]=useState(1);const[isInitiator,setIsInitiator]=useState(false);const[showShareModal,setShowShareModal]=useState(false);const[linkCopied,setLinkCopied]=useState(false);const[showNameModal,setShowNameModal]=useState(false);const[tempUserName,setTempUserName]=useState('');const[connectionRetries,setConnectionRetries]=useState(0);const[maxRetries]=useState(5);const[activeSpeaker,setActiveSpeaker]=useState(null);const localVideoRef=useRef(null);const remoteVideoRefs=useRef(new Map());const peerConnections=useRef(new Map());const audioAnalyzers=useRef(new Map());const animationFrameRef=useRef(null);const userName=searchParams.get('name')||'Anonymous';// Connection retry with exponential backoff\nconst retryConnection=useCallback(()=>{if(connectionRetries<maxRetries){const delay=Math.pow(2,connectionRetries)*1000;// Exponential backoff: 1s, 2s, 4s, 8s, 16s\nconsole.log(\"Retrying connection in \".concat(delay,\"ms (attempt \").concat(connectionRetries+1,\"/\").concat(maxRetries,\")\"));setTimeout(()=>{setConnectionRetries(prev=>prev+1);// Force a page reload to trigger new connection\nwindow.location.reload();},delay);}else{console.error('Max connection retries reached. Please refresh the page.');alert('Unable to connect to the server. Please refresh the page and try again.');}},[connectionRetries,maxRetries]);// Check if we need to show the name entry modal\nuseEffect(()=>{const nameParam=searchParams.get('name');if(!nameParam||nameParam.trim()===''){setShowNameModal(true);}},[searchParams]);// Audio level analysis for active speaker detection\nconst createAudioAnalyzer=useCallback((stream,userId)=>{try{if(!stream)return null;const audioContext=new(window.AudioContext||window.webkitAudioContext)();const analyser=audioContext.createAnalyser();const microphone=audioContext.createMediaStreamSource(stream);const dataArray=new Uint8Array(analyser.frequencyBinCount);analyser.fftSize=256;analyser.smoothingTimeConstant=0.8;microphone.connect(analyser);audioAnalyzers.current.set(userId,{analyser,dataArray,audioContext});return{analyser,dataArray,audioContext};}catch(error){console.error('Error creating audio analyzer:',error);return null;}},[]);const analyzeAudioLevels=useCallback(()=>{try{let maxLevel=0;let currentActiveSpeaker=null;audioAnalyzers.current.forEach((_ref,userId)=>{let{analyser,dataArray}=_ref;if(analyser&&dataArray){analyser.getByteFrequencyData(dataArray);const average=dataArray.reduce((sum,value)=>sum+value,0)/dataArray.length;const level=average/255;// Normalize to 0-1\nif(level>maxLevel&&level>0.1){// Threshold to avoid noise\nmaxLevel=level;currentActiveSpeaker=userId;}}});setActiveSpeaker(currentActiveSpeaker);animationFrameRef.current=requestAnimationFrame(analyzeAudioLevels);}catch(error){console.error('Error in audio analysis:',error);}},[]);const startAudioAnalysis=useCallback(()=>{if(animationFrameRef.current){cancelAnimationFrame(animationFrameRef.current);}analyzeAudioLevels();},[analyzeAudioLevels]);const stopAudioAnalysis=useCallback(()=>{if(animationFrameRef.current){cancelAnimationFrame(animationFrameRef.current);animationFrameRef.current=null;}},[]);// Browser notification functionality\nconst requestNotificationPermission=useCallback(async()=>{try{if('Notification'in window&&Notification.permission==='default'){await Notification.requestPermission();}}catch(error){console.error('Error requesting notification permission:',error);}},[]);const showNotification=useCallback(message=>{try{if('Notification'in window&&Notification.permission==='granted'){new Notification('New CMA Meeting Message',{body:\"\".concat(message.sender,\": \").concat(message.text),icon:'/favicon.ico',tag:'cma-chat',requireInteraction:false});}}catch(error){console.error('Error showing notification:',error);}},[]);// Initialize socket connection\nuseEffect(()=>{const socketUrl=process.env.NODE_ENV==='production'?window.location.origin:'http://localhost:5001';console.log('Connecting to socket:',socketUrl);const newSocket=io(socketUrl,{transports:['polling','websocket'],timeout:20000,forceNew:true,upgrade:false,rememberUpgrade:false});newSocket.on('connect',()=>{console.log('Socket connected with ID:',newSocket.id);console.log('Socket transport:',newSocket.io.engine.transport.name);// Reset retry counter on successful connection\nsetConnectionRetries(0);});newSocket.on('disconnect',reason=>{console.log('Socket disconnected, reason:',reason);});newSocket.on('connect_error',error=>{console.error('Socket connection error:',error);console.error('Error details:',error.message,error.description,error.context);// Check if it's a 502 error (server down)\nif(error.message&&(error.message.includes('502')||error.message.includes('xhr poll error'))){console.log('Server appears to be down (502 error), attempting retry...');retryConnection();return;}// If WebSocket fails, try polling only\nif(error.message&&error.message.includes('websocket')){console.log('WebSocket failed, attempting polling-only connection...');newSocket.io.opts.transports=['polling'];newSocket.io.opts.upgrade=false;newSocket.connect();}});newSocket.on('reconnect',attemptNumber=>{console.log('Socket reconnected after',attemptNumber,'attempts');});newSocket.on('reconnect_error',error=>{console.error('Socket reconnection error:',error);});setSocket(newSocket);return()=>{newSocket.close();};},[retryConnection]);// Create peer connection\nconst createPeerConnection=useCallback(userId=>{console.log('Creating peer connection for user:',userId);const peerConnection=new RTCPeerConnection({iceServers:[{urls:'stun:stun.l.google.com:19302'},{urls:'stun:stun1.l.google.com:19302'}]});// Add local stream tracks\nif(localStream){localStream.getTracks().forEach(track=>{peerConnection.addTrack(track,localStream);console.log('Added track to peer connection:',track.kind);});}else{console.log('No local stream available when creating peer connection');}// Handle remote stream\npeerConnection.ontrack=event=>{var _event$streams$;console.log('Received remote stream from:',userId);console.log('Remote stream tracks:',(_event$streams$=event.streams[0])===null||_event$streams$===void 0?void 0:_event$streams$.getTracks());const[remoteStream]=event.streams;setRemoteStreams(prev=>{const newMap=new Map(prev).set(userId,remoteStream);console.log('Updated remote streams map:',Array.from(newMap.keys()));return newMap;});// Create audio analyzer for remote stream (with error handling)\ntry{createAudioAnalyzer(remoteStream,userId);}catch(error){console.error('Error creating audio analyzer in peer connection:',error);}};// Handle ICE candidates\npeerConnection.onicecandidate=event=>{if(event.candidate){console.log('Sending ICE candidate to:',userId);socket.emit('ice-candidate',{candidate:event.candidate,roomId,userId});}};// Handle connection state changes\npeerConnection.onconnectionstatechange=()=>{console.log(\"Connection state with \".concat(userId,\":\"),peerConnection.connectionState);};peerConnections.current.set(userId,peerConnection);},[localStream,socket,roomId,createAudioAnalyzer]);// Handle offer received\nconst handleOfferReceived=useCallback(async data=>{const{offer,userId}=data;console.log('Processing offer from:',userId);let peerConnection=peerConnections.current.get(userId);if(!peerConnection){console.log('Creating new peer connection for offer from:',userId);createPeerConnection(userId);peerConnection=peerConnections.current.get(userId);}try{await peerConnection.setRemoteDescription(new RTCSessionDescription(offer));console.log('Set remote description for:',userId);const answer=await peerConnection.createAnswer();await peerConnection.setLocalDescription(answer);console.log('Created and set local answer for:',userId);socket.emit('answer',{answer,roomId,userId});console.log('Sent answer to:',userId);}catch(error){console.error('Error handling offer:',error);}},[createPeerConnection,socket,roomId,createAudioAnalyzer]);// Handle answer received\nconst handleAnswerReceived=useCallback(async data=>{const{answer,userId}=data;console.log('Processing answer from:',userId);const peerConnection=peerConnections.current.get(userId);if(peerConnection){try{await peerConnection.setRemoteDescription(new RTCSessionDescription(answer));console.log('Set remote answer for:',userId);}catch(error){console.error('Error handling answer:',error);}}else{console.error('No peer connection found for answer from:',userId);}},[]);// Handle ICE candidate received\nconst handleIceCandidateReceived=useCallback(async data=>{const{candidate,userId}=data;const peerConnection=peerConnections.current.get(userId);if(peerConnection){try{await peerConnection.addIceCandidate(new RTCIceCandidate(candidate));}catch(error){console.error('Error handling ICE candidate:',error);}}},[]);// Send offer to new user\nconst sendOffer=useCallback(async userId=>{const peerConnection=peerConnections.current.get(userId);if(!peerConnection){console.log('No peer connection found for user:',userId);return;}try{const offer=await peerConnection.createOffer();await peerConnection.setLocalDescription(offer);socket.emit('offer',{offer,roomId,userId});console.log('Offer sent to user:',userId);}catch(error){console.error('Error sending offer:',error);}},[socket,roomId]);// Initialize local media stream\nuseEffect(()=>{const initLocalStream=async()=>{try{const stream=await navigator.mediaDevices.getUserMedia({video:true,audio:true});setLocalStream(stream);if(localVideoRef.current){localVideoRef.current.srcObject=stream;}// Create audio analyzer for local stream (with error handling)\ntry{createAudioAnalyzer(stream,userName);}catch(error){console.error('Error creating audio analyzer for local stream:',error);}}catch(error){console.error('Error accessing media devices:',error);alert('Unable to access camera and microphone. Please check permissions.');}};initLocalStream();},[createAudioAnalyzer,userName]);// Socket event handlers\nuseEffect(()=>{if(!socket)return;const handleUserConnected=userId=>{console.log('User connected:',userId);// Only increment if it's not ourselves\nif(userId!==userName){setParticipants(prev=>prev+1);createPeerConnection(userId);// Only send offer if we are the initiator (first user or designated initiator)\nif(isInitiator){console.log('Sending offer as initiator to:',userId);setTimeout(()=>{sendOffer(userId);},1000);// Small delay to ensure peer connection is ready\n}else{console.log('Waiting for offer from initiator:',userId);}}else{console.log('Ignoring self-connection event for:',userId);}};const handleUserDisconnected=userId=>{console.log('User disconnected:',userId);setParticipants(prev=>prev-1);if(peerConnections.current.has(userId)){peerConnections.current.get(userId).close();peerConnections.current.delete(userId);}setRemoteStreams(prev=>{const newStreams=new Map(prev);newStreams.delete(userId);return newStreams;});// Clean up audio analyzer\nif(audioAnalyzers.current.has(userId)){const{audioContext}=audioAnalyzers.current.get(userId);audioContext.close();audioAnalyzers.current.delete(userId);}};const handleOffer=async data=>{console.log('Received offer from:',data.userId);await handleOfferReceived(data);};const handleAnswer=async data=>{console.log('Received answer from:',data.userId);await handleAnswerReceived(data);};const handleIceCandidate=async data=>{console.log('Received ICE candidate from:',data.userId);await handleIceCandidateReceived(data);};const handleMessage=data=>{setMessages(prev=>[...prev,data]);// Show notification if chat is not visible or message is from someone else\nif(!showChat||data.sender!==userName){showNotification(data);}};socket.on('user-connected',handleUserConnected);socket.on('user-disconnected',handleUserDisconnected);socket.on('offer',handleOffer);socket.on('answer',handleAnswer);socket.on('ice-candidate',handleIceCandidate);socket.on('receive-message',handleMessage);return()=>{socket.off('user-connected',handleUserConnected);socket.off('user-disconnected',handleUserDisconnected);socket.off('offer',handleOffer);socket.off('answer',handleAnswer);socket.off('ice-candidate',handleIceCandidate);socket.off('receive-message',handleMessage);};},[socket,sendOffer,createPeerConnection,handleOfferReceived,handleAnswerReceived,handleIceCandidateReceived,isInitiator,userName,showChat,showNotification]);// Join room when socket is ready\nuseEffect(()=>{if(socket&&roomId){console.log('Joining room:',roomId,'with user:',userName);socket.emit('join-room',roomId,userName);}},[socket,roomId,userName]);// Listen for room-joined event to determine if we're the initiator\nuseEffect(()=>{if(!socket)return;const handleRoomJoined=data=>{console.log('Room joined response:',data);if(data.isInitiator){setIsInitiator(true);console.log('I am the initiator for this room');}else{setIsInitiator(false);console.log('I am not the initiator, waiting for offers');}// Set the correct participant count\nif(data.totalParticipants){setParticipants(data.totalParticipants);console.log(\"Total participants in room: \".concat(data.totalParticipants));}// Create peer connections for existing participants\nif(data.existingParticipants&&data.existingParticipants.length>0){console.log('Creating peer connections for existing participants:',data.existingParticipants);data.existingParticipants.forEach(userId=>{if(userId!==userName){// Don't create connection to self\ncreatePeerConnection(userId);// If we're the initiator, send offers to existing participants\nif(data.isInitiator){setTimeout(()=>{sendOffer(userId);},1000);}}});}};socket.on('room-joined',handleRoomJoined);return()=>{socket.off('room-joined',handleRoomJoined);};},[socket,createPeerConnection,sendOffer,userName]);// Share room functionality\nconst getShareLink=()=>{const baseUrl=window.location.origin;return\"\".concat(baseUrl,\"/room/\").concat(roomId,\"?name=\");};const copyToClipboard=async()=>{try{await navigator.clipboard.writeText(getShareLink());setLinkCopied(true);setTimeout(()=>setLinkCopied(false),2000);}catch(err){console.error('Failed to copy: ',err);// Fallback for older browsers\nconst textArea=document.createElement('textarea');textArea.value=getShareLink();document.body.appendChild(textArea);textArea.select();document.execCommand('copy');document.body.removeChild(textArea);setLinkCopied(true);setTimeout(()=>setLinkCopied(false),2000);}};const openShareModal=()=>{setShowShareModal(true);setLinkCopied(false);};const closeShareModal=()=>{setShowShareModal(false);setLinkCopied(false);};// Name modal functions\nconst handleNameSubmit=()=>{if(tempUserName.trim()){// Update the URL with the entered name\nconst newUrl=\"\".concat(window.location.pathname,\"?name=\").concat(encodeURIComponent(tempUserName.trim()));window.history.replaceState({},'',newUrl);setShowNameModal(false);// Reload the page to pick up the new name parameter\nwindow.location.reload();}};const handleNameKeyPress=e=>{if(e.key==='Enter'){handleNameSubmit();}};// Toggle audio\nconst toggleAudio=()=>{if(localStream){const audioTrack=localStream.getAudioTracks()[0];if(audioTrack){audioTrack.enabled=!audioTrack.enabled;setIsAudioMuted(!audioTrack.enabled);}}};// Toggle video\nconst toggleVideo=()=>{if(localStream){const videoTrack=localStream.getVideoTracks()[0];if(videoTrack){videoTrack.enabled=!videoTrack.enabled;setIsVideoMuted(!videoTrack.enabled);}}};// Toggle screen sharing\nconst toggleScreenShare=async()=>{try{if(!isScreenSharing){const screenStream=await navigator.mediaDevices.getDisplayMedia({video:true,audio:true});// Replace video track in all peer connections\nconst videoTrack=screenStream.getVideoTracks()[0];peerConnections.current.forEach(peerConnection=>{const sender=peerConnection.getSenders().find(s=>s.track&&s.track.kind==='video');if(sender){sender.replaceTrack(videoTrack);}});// Update local video\nif(localVideoRef.current){localVideoRef.current.srcObject=screenStream;}setIsScreenSharing(true);// Handle screen share end\nvideoTrack.onended=()=>{toggleScreenShare();};}else{// Stop screen sharing and restore camera\nif(localStream){const videoTrack=localStream.getVideoTracks()[0];peerConnections.current.forEach(peerConnection=>{const sender=peerConnection.getSenders().find(s=>s.track&&s.track.kind==='video');if(sender){sender.replaceTrack(videoTrack);}});if(localVideoRef.current){localVideoRef.current.srcObject=localStream;}}setIsScreenSharing(false);}}catch(error){console.error('Error toggling screen share:',error);}};// Send message\nconst sendMessage=()=>{if(newMessage.trim()&&socket){const message={text:newMessage.trim(),sender:userName,timestamp:new Date().toISOString()};socket.emit('send-message',{message,roomId});setNewMessage('');}};// Leave room\nconst leaveRoom=()=>{if(socket){socket.emit('leave-room',roomId,userName);}// Close all peer connections\npeerConnections.current.forEach(peerConnection=>{peerConnection.close();});// Stop local stream\nif(localStream){localStream.getTracks().forEach(track=>track.stop());}navigate('/');};// Handle key press for message input\nconst handleKeyPress=e=>{if(e.key==='Enter'){sendMessage();}};// Start audio analysis when we have streams\nuseEffect(()=>{if(localStream||remoteStreams.size>0){startAudioAnalysis();}else{stopAudioAnalysis();}return()=>{stopAudioAnalysis();// Clean up all audio analyzers\nconst currentAnalyzers=audioAnalyzers.current;currentAnalyzers.forEach(_ref2=>{let{audioContext}=_ref2;audioContext.close();});currentAnalyzers.clear();};},[localStream,remoteStreams,startAudioAnalysis,stopAudioAnalysis]);// Request notification permission on component mount\nuseEffect(()=>{requestNotificationPermission();},[requestNotificationPermission]);// Ping server every 5 minutes to keep Render service alive\nuseEffect(()=>{const pingServer=async()=>{try{const response=await fetch('/api/ping');if(response.ok){const data=await response.json();console.log('Server ping successful:',data.message);}else{console.warn('Server ping failed:',response.status);}}catch(error){console.error('Server ping error:',error);}};// Ping immediately on mount\npingServer();// Set up interval to ping every 5 minutes (300,000 ms)\nconst pingInterval=setInterval(pingServer,5*60*1000);return()=>{clearInterval(pingInterval);};},[]);// Add error boundary fallback\nif(!roomId){return/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsx(Header,{children:/*#__PURE__*/_jsxs(RoomInfo,{children:[/*#__PURE__*/_jsx(Users,{size:20}),/*#__PURE__*/_jsx(RoomId,{children:\"CMA Meeting: Loading...\"})]})}),/*#__PURE__*/_jsx(MainContent,{children:/*#__PURE__*/_jsx(\"div\",{style:{color:'white',padding:'20px',textAlign:'center'},children:\"Loading meeting room...\"})})]});}return/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsx(Header,{children:/*#__PURE__*/_jsxs(RoomInfo,{children:[/*#__PURE__*/_jsx(Users,{size:20}),/*#__PURE__*/_jsxs(RoomId,{children:[\"CMA Meeting: \",roomId]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"(\",participants,\" members)\"]})]})}),/*#__PURE__*/_jsxs(MainContent,{children:[/*#__PURE__*/_jsxs(VideoGrid,{children:[/*#__PURE__*/_jsxs(VideoContainer,{isActiveSpeaker:activeSpeaker===userName,children:[/*#__PURE__*/_jsx(StyledVideo,{ref:localVideoRef,autoPlay:true,muted:true,playsInline:true}),/*#__PURE__*/_jsxs(VideoLabel,{children:[userName,\" (You)\"]})]}),Array.from(remoteStreams.entries()).map(_ref3=>{let[userId,stream]=_ref3;console.log('Rendering remote video for user:',userId,'stream:',stream);return/*#__PURE__*/_jsxs(VideoContainer,{isActiveSpeaker:activeSpeaker===userId,children:[/*#__PURE__*/_jsx(StyledVideo,{ref:ref=>{if(ref){ref.srcObject=stream;remoteVideoRefs.current.set(userId,ref);console.log('Set remote video srcObject for user:',userId);}},autoPlay:true,playsInline:true}),/*#__PURE__*/_jsx(VideoLabel,{children:userId})]},userId);})]}),showChat&&/*#__PURE__*/_jsxs(ChatPanel,{children:[/*#__PURE__*/_jsxs(ChatHeader,{children:[/*#__PURE__*/_jsx(\"span\",{children:\"CMA Fellowship Chat\"}),/*#__PURE__*/_jsx(CloseButton,{onClick:()=>setShowChat(false),children:\"\\xD7\"})]}),/*#__PURE__*/_jsx(ChatMessages,{children:messages.map((message,index)=>/*#__PURE__*/_jsxs(Message,{isOwn:message.sender===userName,children:[/*#__PURE__*/_jsx(MessageSender,{children:message.sender}),message.text]},index))}),/*#__PURE__*/_jsxs(ChatInput,{children:[/*#__PURE__*/_jsx(MessageInput,{type:\"text\",placeholder:\"Share your experience, strength, and hope...\",value:newMessage,onChange:e=>setNewMessage(e.target.value),onKeyPress:handleKeyPress}),/*#__PURE__*/_jsx(SendButton,{onClick:sendMessage,children:/*#__PURE__*/_jsx(Send,{size:16})})]})]})]}),/*#__PURE__*/_jsxs(Controls,{children:[/*#__PURE__*/_jsx(ControlButton,{onClick:toggleAudio,active:!isAudioMuted,title:isAudioMuted?'Unmute':'Mute',children:isAudioMuted?/*#__PURE__*/_jsx(MicOff,{size:20}):/*#__PURE__*/_jsx(Mic,{size:20})}),/*#__PURE__*/_jsx(ControlButton,{onClick:toggleVideo,active:!isVideoMuted,title:isVideoMuted?'Turn on camera':'Turn off camera',children:isVideoMuted?/*#__PURE__*/_jsx(VideoOff,{size:20}):/*#__PURE__*/_jsx(Video,{size:20})}),/*#__PURE__*/_jsx(ControlButton,{onClick:toggleScreenShare,active:isScreenSharing,title:isScreenSharing?'Stop sharing':'Share screen',children:/*#__PURE__*/_jsx(Monitor,{size:20})}),/*#__PURE__*/_jsx(ControlButton,{onClick:()=>setShowChat(!showChat),active:showChat,title:\"Toggle chat\",children:/*#__PURE__*/_jsx(MessageSquare,{size:20})}),/*#__PURE__*/_jsx(ControlButton,{onClick:openShareModal,title:\"Share room link\",children:/*#__PURE__*/_jsx(Share2,{size:20})}),/*#__PURE__*/_jsx(ControlButton,{onClick:leaveRoom,className:\"leave\",title:\"Leave room\",children:/*#__PURE__*/_jsx(Phone,{size:20})})]}),showShareModal&&/*#__PURE__*/_jsx(ShareModal,{onClick:closeShareModal,children:/*#__PURE__*/_jsxs(ShareModalContent,{onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(ShareModalHeader,{children:[/*#__PURE__*/_jsx(ShareModalTitle,{children:\"Share Meeting\"}),/*#__PURE__*/_jsx(CloseModalButton,{onClick:closeShareModal,children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(ShareSection,{children:[/*#__PURE__*/_jsx(ShareLabel,{children:\"Meeting Link\"}),/*#__PURE__*/_jsxs(ShareInputContainer,{children:[/*#__PURE__*/_jsx(ShareInput,{type:\"text\",value:getShareLink(),readOnly:true}),/*#__PURE__*/_jsx(CopyButton,{onClick:copyToClipboard,disabled:linkCopied,children:linkCopied?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Check,{size:16}),\"Copied!\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Copy,{size:16}),\"Copy\"]})})]})]}),/*#__PURE__*/_jsx(ShareInstructions,{children:/*#__PURE__*/_jsxs(ShareInstructionsText,{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"How to invite others:\"}),/*#__PURE__*/_jsx(\"br\",{}),\"1. Copy the meeting link above\",/*#__PURE__*/_jsx(\"br\",{}),\"2. Share it via text, email, or any messaging app\",/*#__PURE__*/_jsx(\"br\",{}),\"3. Recipients can click the link to join the meeting\",/*#__PURE__*/_jsx(\"br\",{}),\"4. They'll be prompted to enter their name before joining\"]})})]})}),showNameModal&&/*#__PURE__*/_jsx(NameModal,{children:/*#__PURE__*/_jsxs(NameModalContent,{children:[/*#__PURE__*/_jsxs(NameModalHeader,{children:[/*#__PURE__*/_jsx(NameModalTitle,{children:\"Join CMA Meeting\"}),/*#__PURE__*/_jsx(NameModalSubtitle,{children:\"Please enter your name to join the meeting\"})]}),/*#__PURE__*/_jsx(NameInput,{type:\"text\",placeholder:\"Enter your name\",value:tempUserName,onChange:e=>setTempUserName(e.target.value),onKeyPress:handleNameKeyPress,autoFocus:true}),/*#__PURE__*/_jsx(NameModalButton,{onClick:handleNameSubmit,disabled:!tempUserName.trim(),children:\"Join Meeting\"})]})})]});};export default VideoRoom;","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","useParams","useSearchParams","useNavigate","io","styled","Mic","MicOff","Video","VideoOff","Monitor","MessageSquare","Phone","Users","Send","Share2","Copy","Check","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Container","div","_templateObject","_taggedTemplateLiteral","Header","_templateObject2","RoomInfo","_templateObject3","RoomId","span","_templateObject4","MainContent","_templateObject5","VideoGrid","_templateObject6","VideoContainer","_templateObject7","props","isActiveSpeaker","StyledVideo","video","_templateObject8","VideoLabel","_templateObject9","ChatPanel","_templateObject0","ChatHeader","_templateObject1","CloseButton","button","_templateObject10","ChatMessages","_templateObject11","Message","_templateObject12","isOwn","MessageSender","_templateObject13","ChatInput","_templateObject14","MessageInput","input","_templateObject15","SendButton","_templateObject16","Controls","_templateObject17","ControlButton","_templateObject18","active","ShareModal","_templateObject19","ShareModalContent","_templateObject20","ShareModalHeader","_templateObject21","ShareModalTitle","h3","_templateObject22","CloseModalButton","_templateObject23","ShareSection","_templateObject24","ShareLabel","label","_templateObject25","ShareInputContainer","_templateObject26","ShareInput","_templateObject27","CopyButton","_templateObject28","ShareInstructions","_templateObject29","ShareInstructionsText","p","_templateObject30","NameModal","_templateObject31","NameModalContent","_templateObject32","NameModalHeader","_templateObject33","NameModalTitle","h2","_templateObject34","NameModalSubtitle","_templateObject35","NameInput","_templateObject36","NameModalButton","_templateObject37","VideoRoom","roomId","searchParams","navigate","console","log","socket","setSocket","localStream","setLocalStream","remoteStreams","setRemoteStreams","Map","isAudioMuted","setIsAudioMuted","isVideoMuted","setIsVideoMuted","isScreenSharing","setIsScreenSharing","showChat","setShowChat","messages","setMessages","newMessage","setNewMessage","participants","setParticipants","isInitiator","setIsInitiator","showShareModal","setShowShareModal","linkCopied","setLinkCopied","showNameModal","setShowNameModal","tempUserName","setTempUserName","connectionRetries","setConnectionRetries","maxRetries","activeSpeaker","setActiveSpeaker","localVideoRef","remoteVideoRefs","peerConnections","audioAnalyzers","animationFrameRef","userName","get","retryConnection","delay","Math","pow","concat","setTimeout","prev","window","location","reload","error","alert","nameParam","trim","createAudioAnalyzer","stream","userId","audioContext","AudioContext","webkitAudioContext","analyser","createAnalyser","microphone","createMediaStreamSource","dataArray","Uint8Array","frequencyBinCount","fftSize","smoothingTimeConstant","connect","current","set","analyzeAudioLevels","maxLevel","currentActiveSpeaker","forEach","_ref","getByteFrequencyData","average","reduce","sum","value","length","level","requestAnimationFrame","startAudioAnalysis","cancelAnimationFrame","stopAudioAnalysis","requestNotificationPermission","Notification","permission","requestPermission","showNotification","message","body","sender","text","icon","tag","requireInteraction","socketUrl","process","env","NODE_ENV","origin","newSocket","transports","timeout","forceNew","upgrade","rememberUpgrade","on","id","engine","transport","name","reason","description","context","includes","opts","attemptNumber","close","createPeerConnection","peerConnection","RTCPeerConnection","iceServers","urls","getTracks","track","addTrack","kind","ontrack","event","_event$streams$","streams","remoteStream","newMap","Array","from","keys","onicecandidate","candidate","emit","onconnectionstatechange","connectionState","handleOfferReceived","data","offer","setRemoteDescription","RTCSessionDescription","answer","createAnswer","setLocalDescription","handleAnswerReceived","handleIceCandidateReceived","addIceCandidate","RTCIceCandidate","sendOffer","createOffer","initLocalStream","navigator","mediaDevices","getUserMedia","audio","srcObject","handleUserConnected","handleUserDisconnected","has","delete","newStreams","handleOffer","handleAnswer","handleIceCandidate","handleMessage","off","handleRoomJoined","totalParticipants","existingParticipants","getShareLink","baseUrl","copyToClipboard","clipboard","writeText","err","textArea","document","createElement","appendChild","select","execCommand","removeChild","openShareModal","closeShareModal","handleNameSubmit","newUrl","pathname","encodeURIComponent","history","replaceState","handleNameKeyPress","e","key","toggleAudio","audioTrack","getAudioTracks","enabled","toggleVideo","videoTrack","getVideoTracks","toggleScreenShare","screenStream","getDisplayMedia","getSenders","find","s","replaceTrack","onended","sendMessage","timestamp","Date","toISOString","leaveRoom","stop","handleKeyPress","size","currentAnalyzers","_ref2","clear","pingServer","response","fetch","ok","json","warn","status","pingInterval","setInterval","clearInterval","children","style","color","padding","textAlign","ref","autoPlay","muted","playsInline","entries","map","_ref3","onClick","index","type","placeholder","onChange","target","onKeyPress","title","className","stopPropagation","readOnly","disabled","autoFocus"],"sources":["/Users/matty/VideoChat/VideoChat/client/src/components/VideoRoom.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useParams, useSearchParams, useNavigate } from 'react-router-dom';\nimport io from 'socket.io-client';\nimport styled from 'styled-components';\nimport { \n  Mic, \n  MicOff, \n  Video, \n  VideoOff, \n  Monitor, \n  MessageSquare, \n  Phone, \n  Users,\n  Send,\n  Share2,\n  Copy,\n  Check\n} from 'lucide-react';\n\nconst Container = styled.div`\n  min-height: 100vh;\n  background: #1a1a1a;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst Header = styled.div`\n  background: #2d2d2d;\n  padding: 15px 20px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  color: white;\n`;\n\nconst RoomInfo = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 10px;\n`;\n\nconst RoomId = styled.span`\n  font-weight: 600;\n  font-size: 1.1rem;\n`;\n\nconst MainContent = styled.div`\n  flex: 1;\n  display: flex;\n  position: relative;\n`;\n\nconst VideoGrid = styled.div`\n  flex: 1;\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n  gap: 10px;\n  padding: 20px;\n  align-content: start;\n`;\n\nconst VideoContainer = styled.div`\n  position: relative;\n  background: #333;\n  border-radius: 10px;\n  overflow: hidden;\n  aspect-ratio: 16/9;\n  min-height: 200px;\n  border: ${props => props.isActiveSpeaker ? '3px solid #667eea' : '3px solid transparent'};\n  transition: border-color 0.3s ease;\n  box-shadow: ${props => props.isActiveSpeaker ? '0 0 20px rgba(102, 126, 234, 0.5)' : 'none'};\n`;\n\nconst StyledVideo = styled.video`\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n`;\n\nconst VideoLabel = styled.div`\n  position: absolute;\n  bottom: 10px;\n  left: 10px;\n  background: rgba(0, 0, 0, 0.7);\n  color: white;\n  padding: 5px 10px;\n  border-radius: 5px;\n  font-size: 0.9rem;\n`;\n\nconst ChatPanel = styled.div`\n  width: 350px;\n  background: #2d2d2d;\n  display: flex;\n  flex-direction: column;\n  border-left: 1px solid #444;\n  \n  @media (max-width: 768px) {\n    position: fixed;\n    top: 0;\n    right: 0;\n    height: 100vh;\n    width: 100vw;\n    z-index: 1000;\n    border-left: none;\n  }\n`;\n\nconst ChatHeader = styled.div`\n  padding: 15px 20px;\n  border-bottom: 1px solid #444;\n  color: white;\n  font-weight: 600;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n`;\n\nconst CloseButton = styled.button`\n  background: none;\n  border: none;\n  color: white;\n  font-size: 1.5rem;\n  cursor: pointer;\n  padding: 5px;\n  display: none;\n  \n  @media (max-width: 768px) {\n    display: block;\n  }\n`;\n\nconst ChatMessages = styled.div`\n  flex: 1;\n  padding: 15px;\n  overflow-y: auto;\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n`;\n\nconst Message = styled.div`\n  background: ${props => props.isOwn ? '#667eea' : '#444'};\n  color: white;\n  padding: 10px 15px;\n  border-radius: 10px;\n  max-width: 80%;\n  align-self: ${props => props.isOwn ? 'flex-end' : 'flex-start'};\n  word-wrap: break-word;\n`;\n\nconst MessageSender = styled.div`\n  font-size: 0.8rem;\n  opacity: 0.7;\n  margin-bottom: 5px;\n`;\n\nconst ChatInput = styled.div`\n  padding: 15px;\n  border-top: 1px solid #444;\n  display: flex;\n  gap: 10px;\n`;\n\nconst MessageInput = styled.input`\n  flex: 1;\n  padding: 10px 15px;\n  border: 1px solid #555;\n  border-radius: 20px;\n  background: #333;\n  color: white;\n  font-size: 0.9rem;\n\n  &:focus {\n    outline: none;\n    border-color: #667eea;\n  }\n\n  &::placeholder {\n    color: #999;\n  }\n`;\n\nconst SendButton = styled.button`\n  background: #667eea;\n  border: none;\n  border-radius: 50%;\n  width: 40px;\n  height: 40px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n  cursor: pointer;\n  transition: background 0.3s ease;\n\n  &:hover {\n    background: #5a6fd8;\n  }\n`;\n\nconst Controls = styled.div`\n  background: #2d2d2d;\n  padding: 20px;\n  display: flex;\n  justify-content: center;\n  gap: 15px;\n  border-top: 1px solid #444;\n`;\n\nconst ControlButton = styled.button`\n  background: ${props => props.active ? '#667eea' : '#444'};\n  border: none;\n  border-radius: 50%;\n  width: 50px;\n  height: 50px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n  cursor: pointer;\n  transition: all 0.3s ease;\n\n  &:hover {\n    background: ${props => props.active ? '#5a6fd8' : '#555'};\n  }\n\n  &.leave {\n    background: #dc3545;\n    \n    &:hover {\n      background: #c82333;\n    }\n  }\n`;\n\nconst ShareModal = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.8);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 2000;\n`;\n\nconst ShareModalContent = styled.div`\n  background: #2d2d2d;\n  border-radius: 15px;\n  padding: 30px;\n  max-width: 500px;\n  width: 90%;\n  color: white;\n`;\n\nconst ShareModalHeader = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n`;\n\nconst ShareModalTitle = styled.h3`\n  margin: 0;\n  font-size: 1.3rem;\n  color: white;\n`;\n\nconst CloseModalButton = styled.button`\n  background: none;\n  border: none;\n  color: white;\n  font-size: 1.5rem;\n  cursor: pointer;\n  padding: 5px;\n  \n  &:hover {\n    opacity: 0.7;\n  }\n`;\n\nconst ShareSection = styled.div`\n  margin-bottom: 20px;\n`;\n\nconst ShareLabel = styled.label`\n  display: block;\n  margin-bottom: 10px;\n  font-weight: 600;\n  color: #ccc;\n`;\n\nconst ShareInputContainer = styled.div`\n  display: flex;\n  gap: 10px;\n  align-items: center;\n`;\n\nconst ShareInput = styled.input`\n  flex: 1;\n  padding: 12px 15px;\n  border: 1px solid #555;\n  border-radius: 8px;\n  background: #333;\n  color: white;\n  font-size: 0.9rem;\n  \n  &:focus {\n    outline: none;\n    border-color: #667eea;\n  }\n`;\n\nconst CopyButton = styled.button`\n  background: #667eea;\n  border: none;\n  color: white;\n  padding: 12px 15px;\n  border-radius: 8px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-weight: 600;\n  transition: all 0.3s ease;\n  \n  &:hover {\n    background: #5a6fd8;\n  }\n  \n  &:disabled {\n    background: #28a745;\n    cursor: not-allowed;\n  }\n`;\n\nconst ShareInstructions = styled.div`\n  background: rgba(102, 126, 234, 0.1);\n  border: 1px solid rgba(102, 126, 234, 0.3);\n  border-radius: 8px;\n  padding: 15px;\n  margin-top: 15px;\n`;\n\nconst ShareInstructionsText = styled.p`\n  margin: 0;\n  font-size: 0.9rem;\n  color: #ccc;\n  line-height: 1.4;\n`;\n\n// Name Entry Modal Components\nconst NameModal = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.8);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n`;\n\nconst NameModalContent = styled.div`\n  background: white;\n  border-radius: 12px;\n  padding: 32px;\n  max-width: 400px;\n  width: 90%;\n  text-align: center;\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);\n`;\n\nconst NameModalHeader = styled.div`\n  margin-bottom: 24px;\n`;\n\nconst NameModalTitle = styled.h2`\n  margin: 0 0 8px 0;\n  color: #333;\n  font-size: 24px;\n  font-weight: 600;\n`;\n\nconst NameModalSubtitle = styled.p`\n  margin: 0;\n  color: #666;\n  font-size: 16px;\n`;\n\nconst NameInput = styled.input`\n  width: 100%;\n  padding: 12px 16px;\n  border: 2px solid #e1e5e9;\n  border-radius: 8px;\n  font-size: 16px;\n  margin-bottom: 20px;\n  box-sizing: border-box;\n  transition: border-color 0.2s;\n\n  &:focus {\n    outline: none;\n    border-color: #007bff;\n  }\n`;\n\nconst NameModalButton = styled.button`\n  background: #007bff;\n  color: white;\n  border: none;\n  padding: 12px 24px;\n  border-radius: 8px;\n  font-size: 16px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: background-color 0.2s;\n  width: 100%;\n\n  &:hover {\n    background: #0056b3;\n  }\n\n  &:disabled {\n    background: #ccc;\n    cursor: not-allowed;\n  }\n`;\n\nconst VideoRoom = () => {\n  const { roomId } = useParams();\n  const [searchParams] = useSearchParams();\n  const navigate = useNavigate();\n  \n  console.log('VideoRoom component rendering, roomId:', roomId);\n  \n  const [socket, setSocket] = useState(null);\n  const [localStream, setLocalStream] = useState(null);\n  const [remoteStreams, setRemoteStreams] = useState(new Map());\n  const [isAudioMuted, setIsAudioMuted] = useState(false);\n  const [isVideoMuted, setIsVideoMuted] = useState(false);\n  const [isScreenSharing, setIsScreenSharing] = useState(false);\n  const [showChat, setShowChat] = useState(false);\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [participants, setParticipants] = useState(1);\n  const [isInitiator, setIsInitiator] = useState(false);\n  const [showShareModal, setShowShareModal] = useState(false);\n  const [linkCopied, setLinkCopied] = useState(false);\n  const [showNameModal, setShowNameModal] = useState(false);\n  const [tempUserName, setTempUserName] = useState('');\n  const [connectionRetries, setConnectionRetries] = useState(0);\n  const [maxRetries] = useState(5);\n  const [activeSpeaker, setActiveSpeaker] = useState(null);\n\n  const localVideoRef = useRef(null);\n  const remoteVideoRefs = useRef(new Map());\n  const peerConnections = useRef(new Map());\n  const audioAnalyzers = useRef(new Map());\n  const animationFrameRef = useRef(null);\n  const userName = searchParams.get('name') || 'Anonymous';\n  \n  // Connection retry with exponential backoff\n  const retryConnection = useCallback(() => {\n    if (connectionRetries < maxRetries) {\n      const delay = Math.pow(2, connectionRetries) * 1000; // Exponential backoff: 1s, 2s, 4s, 8s, 16s\n      console.log(`Retrying connection in ${delay}ms (attempt ${connectionRetries + 1}/${maxRetries})`);\n      \n      setTimeout(() => {\n        setConnectionRetries(prev => prev + 1);\n        // Force a page reload to trigger new connection\n        window.location.reload();\n      }, delay);\n    } else {\n      console.error('Max connection retries reached. Please refresh the page.');\n      alert('Unable to connect to the server. Please refresh the page and try again.');\n    }\n  }, [connectionRetries, maxRetries]);\n  \n  // Check if we need to show the name entry modal\n  useEffect(() => {\n    const nameParam = searchParams.get('name');\n    if (!nameParam || nameParam.trim() === '') {\n      setShowNameModal(true);\n    }\n  }, [searchParams]);\n\n  // Audio level analysis for active speaker detection\n  const createAudioAnalyzer = useCallback((stream, userId) => {\n    try {\n      if (!stream) return null;\n      \n      const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n      const analyser = audioContext.createAnalyser();\n      const microphone = audioContext.createMediaStreamSource(stream);\n      const dataArray = new Uint8Array(analyser.frequencyBinCount);\n      \n      analyser.fftSize = 256;\n      analyser.smoothingTimeConstant = 0.8;\n      microphone.connect(analyser);\n      \n      audioAnalyzers.current.set(userId, { analyser, dataArray, audioContext });\n      return { analyser, dataArray, audioContext };\n    } catch (error) {\n      console.error('Error creating audio analyzer:', error);\n      return null;\n    }\n  }, []);\n\n  const analyzeAudioLevels = useCallback(() => {\n    try {\n      let maxLevel = 0;\n      let currentActiveSpeaker = null;\n      \n      audioAnalyzers.current.forEach(({ analyser, dataArray }, userId) => {\n        if (analyser && dataArray) {\n          analyser.getByteFrequencyData(dataArray);\n          const average = dataArray.reduce((sum, value) => sum + value, 0) / dataArray.length;\n          const level = average / 255; // Normalize to 0-1\n          \n          if (level > maxLevel && level > 0.1) { // Threshold to avoid noise\n            maxLevel = level;\n            currentActiveSpeaker = userId;\n          }\n        }\n      });\n      \n      setActiveSpeaker(currentActiveSpeaker);\n      \n      animationFrameRef.current = requestAnimationFrame(analyzeAudioLevels);\n    } catch (error) {\n      console.error('Error in audio analysis:', error);\n    }\n  }, []);\n\n  const startAudioAnalysis = useCallback(() => {\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n    analyzeAudioLevels();\n  }, [analyzeAudioLevels]);\n\n  const stopAudioAnalysis = useCallback(() => {\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n      animationFrameRef.current = null;\n    }\n  }, []);\n\n  // Browser notification functionality\n  const requestNotificationPermission = useCallback(async () => {\n    try {\n      if ('Notification' in window && Notification.permission === 'default') {\n        await Notification.requestPermission();\n      }\n    } catch (error) {\n      console.error('Error requesting notification permission:', error);\n    }\n  }, []);\n\n  const showNotification = useCallback((message) => {\n    try {\n      if ('Notification' in window && Notification.permission === 'granted') {\n        new Notification('New CMA Meeting Message', {\n          body: `${message.sender}: ${message.text}`,\n          icon: '/favicon.ico',\n          tag: 'cma-chat',\n          requireInteraction: false\n        });\n      }\n    } catch (error) {\n      console.error('Error showing notification:', error);\n    }\n  }, []);\n\n  // Initialize socket connection\n  useEffect(() => {\n    const socketUrl = process.env.NODE_ENV === 'production' \n      ? window.location.origin \n      : 'http://localhost:5001';\n    console.log('Connecting to socket:', socketUrl);\n    \n    const newSocket = io(socketUrl, {\n      transports: ['polling', 'websocket'],\n      timeout: 20000,\n      forceNew: true,\n      upgrade: false,\n      rememberUpgrade: false\n    });\n    \n    newSocket.on('connect', () => {\n      console.log('Socket connected with ID:', newSocket.id);\n      console.log('Socket transport:', newSocket.io.engine.transport.name);\n      // Reset retry counter on successful connection\n      setConnectionRetries(0);\n    });\n    \n    newSocket.on('disconnect', (reason) => {\n      console.log('Socket disconnected, reason:', reason);\n    });\n    \n    newSocket.on('connect_error', (error) => {\n      console.error('Socket connection error:', error);\n      console.error('Error details:', error.message, error.description, error.context);\n      \n      // Check if it's a 502 error (server down)\n      if (error.message && (error.message.includes('502') || error.message.includes('xhr poll error'))) {\n        console.log('Server appears to be down (502 error), attempting retry...');\n        retryConnection();\n        return;\n      }\n      \n      // If WebSocket fails, try polling only\n      if (error.message && error.message.includes('websocket')) {\n        console.log('WebSocket failed, attempting polling-only connection...');\n        newSocket.io.opts.transports = ['polling'];\n        newSocket.io.opts.upgrade = false;\n        newSocket.connect();\n      }\n    });\n    \n    newSocket.on('reconnect', (attemptNumber) => {\n      console.log('Socket reconnected after', attemptNumber, 'attempts');\n    });\n    \n    newSocket.on('reconnect_error', (error) => {\n      console.error('Socket reconnection error:', error);\n    });\n    \n    setSocket(newSocket);\n\n    return () => {\n      newSocket.close();\n    };\n  }, [retryConnection]);\n\n  // Create peer connection\n  const createPeerConnection = useCallback((userId) => {\n    console.log('Creating peer connection for user:', userId);\n    const peerConnection = new RTCPeerConnection({\n      iceServers: [\n        { urls: 'stun:stun.l.google.com:19302' },\n        { urls: 'stun:stun1.l.google.com:19302' }\n      ]\n    });\n\n    // Add local stream tracks\n    if (localStream) {\n      localStream.getTracks().forEach(track => {\n        peerConnection.addTrack(track, localStream);\n        console.log('Added track to peer connection:', track.kind);\n      });\n    } else {\n      console.log('No local stream available when creating peer connection');\n    }\n\n    // Handle remote stream\n    peerConnection.ontrack = (event) => {\n      console.log('Received remote stream from:', userId);\n      console.log('Remote stream tracks:', event.streams[0]?.getTracks());\n      const [remoteStream] = event.streams;\n      setRemoteStreams(prev => {\n        const newMap = new Map(prev).set(userId, remoteStream);\n        console.log('Updated remote streams map:', Array.from(newMap.keys()));\n        return newMap;\n      });\n      // Create audio analyzer for remote stream (with error handling)\n      try {\n        createAudioAnalyzer(remoteStream, userId);\n      } catch (error) {\n        console.error('Error creating audio analyzer in peer connection:', error);\n      }\n    };\n\n    // Handle ICE candidates\n    peerConnection.onicecandidate = (event) => {\n      if (event.candidate) {\n        console.log('Sending ICE candidate to:', userId);\n        socket.emit('ice-candidate', {\n          candidate: event.candidate,\n          roomId,\n          userId\n        });\n      }\n    };\n\n    // Handle connection state changes\n    peerConnection.onconnectionstatechange = () => {\n      console.log(`Connection state with ${userId}:`, peerConnection.connectionState);\n    };\n\n    peerConnections.current.set(userId, peerConnection);\n  }, [localStream, socket, roomId, createAudioAnalyzer]);\n\n  // Handle offer received\n  const handleOfferReceived = useCallback(async (data) => {\n    const { offer, userId } = data;\n    console.log('Processing offer from:', userId);\n    let peerConnection = peerConnections.current.get(userId);\n    \n    if (!peerConnection) {\n      console.log('Creating new peer connection for offer from:', userId);\n      createPeerConnection(userId);\n      peerConnection = peerConnections.current.get(userId);\n    }\n\n    try {\n      await peerConnection.setRemoteDescription(new RTCSessionDescription(offer));\n      console.log('Set remote description for:', userId);\n      const answer = await peerConnection.createAnswer();\n      await peerConnection.setLocalDescription(answer);\n      console.log('Created and set local answer for:', userId);\n      \n      socket.emit('answer', {\n        answer,\n        roomId,\n        userId\n      });\n      console.log('Sent answer to:', userId);\n    } catch (error) {\n      console.error('Error handling offer:', error);\n    }\n  }, [createPeerConnection, socket, roomId, createAudioAnalyzer]);\n\n  // Handle answer received\n  const handleAnswerReceived = useCallback(async (data) => {\n    const { answer, userId } = data;\n    console.log('Processing answer from:', userId);\n    const peerConnection = peerConnections.current.get(userId);\n    \n    if (peerConnection) {\n      try {\n        await peerConnection.setRemoteDescription(new RTCSessionDescription(answer));\n        console.log('Set remote answer for:', userId);\n      } catch (error) {\n        console.error('Error handling answer:', error);\n      }\n    } else {\n      console.error('No peer connection found for answer from:', userId);\n    }\n  }, []);\n\n  // Handle ICE candidate received\n  const handleIceCandidateReceived = useCallback(async (data) => {\n    const { candidate, userId } = data;\n    const peerConnection = peerConnections.current.get(userId);\n    \n    if (peerConnection) {\n      try {\n        await peerConnection.addIceCandidate(new RTCIceCandidate(candidate));\n      } catch (error) {\n        console.error('Error handling ICE candidate:', error);\n      }\n    }\n  }, []);\n\n  // Send offer to new user\n  const sendOffer = useCallback(async (userId) => {\n    const peerConnection = peerConnections.current.get(userId);\n    if (!peerConnection) {\n      console.log('No peer connection found for user:', userId);\n      return;\n    }\n\n    try {\n      const offer = await peerConnection.createOffer();\n      await peerConnection.setLocalDescription(offer);\n      \n      socket.emit('offer', {\n        offer,\n        roomId,\n        userId\n      });\n      console.log('Offer sent to user:', userId);\n    } catch (error) {\n      console.error('Error sending offer:', error);\n    }\n  }, [socket, roomId]);\n\n  // Initialize local media stream\n  useEffect(() => {\n    const initLocalStream = async () => {\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: true,\n          audio: true\n        });\n        setLocalStream(stream);\n        if (localVideoRef.current) {\n          localVideoRef.current.srcObject = stream;\n        }\n        // Create audio analyzer for local stream (with error handling)\n        try {\n          createAudioAnalyzer(stream, userName);\n        } catch (error) {\n          console.error('Error creating audio analyzer for local stream:', error);\n        }\n      } catch (error) {\n        console.error('Error accessing media devices:', error);\n        alert('Unable to access camera and microphone. Please check permissions.');\n      }\n    };\n\n    initLocalStream();\n  }, [createAudioAnalyzer, userName]);\n\n  // Socket event handlers\n  useEffect(() => {\n    if (!socket) return;\n\n    const handleUserConnected = (userId) => {\n      console.log('User connected:', userId);\n      // Only increment if it's not ourselves\n      if (userId !== userName) {\n        setParticipants(prev => prev + 1);\n        createPeerConnection(userId);\n        \n        // Only send offer if we are the initiator (first user or designated initiator)\n        if (isInitiator) {\n          console.log('Sending offer as initiator to:', userId);\n          setTimeout(() => {\n            sendOffer(userId);\n          }, 1000); // Small delay to ensure peer connection is ready\n        } else {\n          console.log('Waiting for offer from initiator:', userId);\n        }\n      } else {\n        console.log('Ignoring self-connection event for:', userId);\n      }\n    };\n\n    const handleUserDisconnected = (userId) => {\n      console.log('User disconnected:', userId);\n      setParticipants(prev => prev - 1);\n      if (peerConnections.current.has(userId)) {\n        peerConnections.current.get(userId).close();\n        peerConnections.current.delete(userId);\n      }\n      setRemoteStreams(prev => {\n        const newStreams = new Map(prev);\n        newStreams.delete(userId);\n        return newStreams;\n      });\n      // Clean up audio analyzer\n      if (audioAnalyzers.current.has(userId)) {\n        const { audioContext } = audioAnalyzers.current.get(userId);\n        audioContext.close();\n        audioAnalyzers.current.delete(userId);\n      }\n    };\n\n    const handleOffer = async (data) => {\n      console.log('Received offer from:', data.userId);\n      await handleOfferReceived(data);\n    };\n\n    const handleAnswer = async (data) => {\n      console.log('Received answer from:', data.userId);\n      await handleAnswerReceived(data);\n    };\n\n    const handleIceCandidate = async (data) => {\n      console.log('Received ICE candidate from:', data.userId);\n      await handleIceCandidateReceived(data);\n    };\n\n    const handleMessage = (data) => {\n      setMessages(prev => [...prev, data]);\n      // Show notification if chat is not visible or message is from someone else\n      if (!showChat || data.sender !== userName) {\n        showNotification(data);\n      }\n    };\n\n    socket.on('user-connected', handleUserConnected);\n    socket.on('user-disconnected', handleUserDisconnected);\n    socket.on('offer', handleOffer);\n    socket.on('answer', handleAnswer);\n    socket.on('ice-candidate', handleIceCandidate);\n    socket.on('receive-message', handleMessage);\n\n    return () => {\n      socket.off('user-connected', handleUserConnected);\n      socket.off('user-disconnected', handleUserDisconnected);\n      socket.off('offer', handleOffer);\n      socket.off('answer', handleAnswer);\n      socket.off('ice-candidate', handleIceCandidate);\n      socket.off('receive-message', handleMessage);\n    };\n  }, [socket, sendOffer, createPeerConnection, handleOfferReceived, handleAnswerReceived, handleIceCandidateReceived, isInitiator, userName, showChat, showNotification]);\n\n  // Join room when socket is ready\n  useEffect(() => {\n    if (socket && roomId) {\n      console.log('Joining room:', roomId, 'with user:', userName);\n      socket.emit('join-room', roomId, userName);\n    }\n  }, [socket, roomId, userName]);\n\n  // Listen for room-joined event to determine if we're the initiator\n  useEffect(() => {\n    if (!socket) return;\n\n    const handleRoomJoined = (data) => {\n      console.log('Room joined response:', data);\n      if (data.isInitiator) {\n        setIsInitiator(true);\n        console.log('I am the initiator for this room');\n      } else {\n        setIsInitiator(false);\n        console.log('I am not the initiator, waiting for offers');\n      }\n      \n      // Set the correct participant count\n      if (data.totalParticipants) {\n        setParticipants(data.totalParticipants);\n        console.log(`Total participants in room: ${data.totalParticipants}`);\n      }\n      \n      // Create peer connections for existing participants\n      if (data.existingParticipants && data.existingParticipants.length > 0) {\n        console.log('Creating peer connections for existing participants:', data.existingParticipants);\n        data.existingParticipants.forEach(userId => {\n          if (userId !== userName) { // Don't create connection to self\n            createPeerConnection(userId);\n            // If we're the initiator, send offers to existing participants\n            if (data.isInitiator) {\n              setTimeout(() => {\n                sendOffer(userId);\n              }, 1000);\n            }\n          }\n        });\n      }\n    };\n\n    socket.on('room-joined', handleRoomJoined);\n\n    return () => {\n      socket.off('room-joined', handleRoomJoined);\n    };\n  }, [socket, createPeerConnection, sendOffer, userName]);\n\n\n  // Share room functionality\n  const getShareLink = () => {\n    const baseUrl = window.location.origin;\n    return `${baseUrl}/room/${roomId}?name=`;\n  };\n\n  const copyToClipboard = async () => {\n    try {\n      await navigator.clipboard.writeText(getShareLink());\n      setLinkCopied(true);\n      setTimeout(() => setLinkCopied(false), 2000);\n    } catch (err) {\n      console.error('Failed to copy: ', err);\n      // Fallback for older browsers\n      const textArea = document.createElement('textarea');\n      textArea.value = getShareLink();\n      document.body.appendChild(textArea);\n      textArea.select();\n      document.execCommand('copy');\n      document.body.removeChild(textArea);\n      setLinkCopied(true);\n      setTimeout(() => setLinkCopied(false), 2000);\n    }\n  };\n\n  const openShareModal = () => {\n    setShowShareModal(true);\n    setLinkCopied(false);\n  };\n\n  const closeShareModal = () => {\n    setShowShareModal(false);\n    setLinkCopied(false);\n  };\n\n  // Name modal functions\n  const handleNameSubmit = () => {\n    if (tempUserName.trim()) {\n      // Update the URL with the entered name\n      const newUrl = `${window.location.pathname}?name=${encodeURIComponent(tempUserName.trim())}`;\n      window.history.replaceState({}, '', newUrl);\n      setShowNameModal(false);\n      // Reload the page to pick up the new name parameter\n      window.location.reload();\n    }\n  };\n\n  const handleNameKeyPress = (e) => {\n    if (e.key === 'Enter') {\n      handleNameSubmit();\n    }\n  };\n\n  // Toggle audio\n  const toggleAudio = () => {\n    if (localStream) {\n      const audioTrack = localStream.getAudioTracks()[0];\n      if (audioTrack) {\n        audioTrack.enabled = !audioTrack.enabled;\n        setIsAudioMuted(!audioTrack.enabled);\n      }\n    }\n  };\n\n  // Toggle video\n  const toggleVideo = () => {\n    if (localStream) {\n      const videoTrack = localStream.getVideoTracks()[0];\n      if (videoTrack) {\n        videoTrack.enabled = !videoTrack.enabled;\n        setIsVideoMuted(!videoTrack.enabled);\n      }\n    }\n  };\n\n  // Toggle screen sharing\n  const toggleScreenShare = async () => {\n    try {\n      if (!isScreenSharing) {\n        const screenStream = await navigator.mediaDevices.getDisplayMedia({\n          video: true,\n          audio: true\n        });\n        \n        // Replace video track in all peer connections\n        const videoTrack = screenStream.getVideoTracks()[0];\n        peerConnections.current.forEach(peerConnection => {\n          const sender = peerConnection.getSenders().find(s => \n            s.track && s.track.kind === 'video'\n          );\n          if (sender) {\n            sender.replaceTrack(videoTrack);\n          }\n        });\n\n        // Update local video\n        if (localVideoRef.current) {\n          localVideoRef.current.srcObject = screenStream;\n        }\n\n        setIsScreenSharing(true);\n\n        // Handle screen share end\n        videoTrack.onended = () => {\n          toggleScreenShare();\n        };\n      } else {\n        // Stop screen sharing and restore camera\n        if (localStream) {\n          const videoTrack = localStream.getVideoTracks()[0];\n          peerConnections.current.forEach(peerConnection => {\n            const sender = peerConnection.getSenders().find(s => \n              s.track && s.track.kind === 'video'\n            );\n            if (sender) {\n              sender.replaceTrack(videoTrack);\n            }\n          });\n\n          if (localVideoRef.current) {\n            localVideoRef.current.srcObject = localStream;\n          }\n        }\n        setIsScreenSharing(false);\n      }\n    } catch (error) {\n      console.error('Error toggling screen share:', error);\n    }\n  };\n\n  // Send message\n  const sendMessage = () => {\n    if (newMessage.trim() && socket) {\n      const message = {\n        text: newMessage.trim(),\n        sender: userName,\n        timestamp: new Date().toISOString()\n      };\n      \n      socket.emit('send-message', { message, roomId });\n      setNewMessage('');\n    }\n  };\n\n  // Leave room\n  const leaveRoom = () => {\n    if (socket) {\n      socket.emit('leave-room', roomId, userName);\n    }\n    \n    // Close all peer connections\n    peerConnections.current.forEach(peerConnection => {\n      peerConnection.close();\n    });\n    \n    // Stop local stream\n    if (localStream) {\n      localStream.getTracks().forEach(track => track.stop());\n    }\n    \n    navigate('/');\n  };\n\n  // Handle key press for message input\n  const handleKeyPress = (e) => {\n    if (e.key === 'Enter') {\n      sendMessage();\n    }\n  };\n\n  // Start audio analysis when we have streams\n  useEffect(() => {\n    if (localStream || remoteStreams.size > 0) {\n      startAudioAnalysis();\n    } else {\n      stopAudioAnalysis();\n    }\n    \n    return () => {\n      stopAudioAnalysis();\n      // Clean up all audio analyzers\n      const currentAnalyzers = audioAnalyzers.current;\n      currentAnalyzers.forEach(({ audioContext }) => {\n        audioContext.close();\n      });\n      currentAnalyzers.clear();\n    };\n  }, [localStream, remoteStreams, startAudioAnalysis, stopAudioAnalysis]);\n\n  // Request notification permission on component mount\n  useEffect(() => {\n    requestNotificationPermission();\n  }, [requestNotificationPermission]);\n\n  // Ping server every 5 minutes to keep Render service alive\n  useEffect(() => {\n    const pingServer = async () => {\n      try {\n        const response = await fetch('/api/ping');\n        if (response.ok) {\n          const data = await response.json();\n          console.log('Server ping successful:', data.message);\n        } else {\n          console.warn('Server ping failed:', response.status);\n        }\n      } catch (error) {\n        console.error('Server ping error:', error);\n      }\n    };\n\n    // Ping immediately on mount\n    pingServer();\n\n    // Set up interval to ping every 5 minutes (300,000 ms)\n    const pingInterval = setInterval(pingServer, 5 * 60 * 1000);\n\n    return () => {\n      clearInterval(pingInterval);\n    };\n  }, []);\n\n  // Add error boundary fallback\n  if (!roomId) {\n    return (\n      <Container>\n        <Header>\n          <RoomInfo>\n            <Users size={20} />\n            <RoomId>CMA Meeting: Loading...</RoomId>\n          </RoomInfo>\n        </Header>\n        <MainContent>\n          <div style={{ color: 'white', padding: '20px', textAlign: 'center' }}>\n            Loading meeting room...\n          </div>\n        </MainContent>\n      </Container>\n    );\n  }\n\n  return (\n    <Container>\n      <Header>\n        <RoomInfo>\n          <Users size={20} />\n          <RoomId>CMA Meeting: {roomId}</RoomId>\n          <span>({participants} members)</span>\n        </RoomInfo>\n      </Header>\n\n      <MainContent>\n        <VideoGrid>\n          {/* Local video */}\n          <VideoContainer isActiveSpeaker={activeSpeaker === userName}>\n            <StyledVideo\n              ref={localVideoRef}\n              autoPlay\n              muted\n              playsInline\n            />\n            <VideoLabel>{userName} (You)</VideoLabel>\n          </VideoContainer>\n\n          {/* Remote videos */}\n          {Array.from(remoteStreams.entries()).map(([userId, stream]) => {\n            console.log('Rendering remote video for user:', userId, 'stream:', stream);\n            return (\n              <VideoContainer key={userId} isActiveSpeaker={activeSpeaker === userId}>\n                <StyledVideo\n                  ref={ref => {\n                    if (ref) {\n                      ref.srcObject = stream;\n                      remoteVideoRefs.current.set(userId, ref);\n                      console.log('Set remote video srcObject for user:', userId);\n                    }\n                  }}\n                  autoPlay\n                  playsInline\n              />\n              <VideoLabel>{userId}</VideoLabel>\n            </VideoContainer>\n            );\n          })}\n        </VideoGrid>\n\n        {showChat && (\n          <ChatPanel>\n            <ChatHeader>\n              <span>CMA Fellowship Chat</span>\n              <CloseButton onClick={() => setShowChat(false)}>×</CloseButton>\n            </ChatHeader>\n            <ChatMessages>\n              {messages.map((message, index) => (\n                <Message key={index} isOwn={message.sender === userName}>\n                  <MessageSender>{message.sender}</MessageSender>\n                  {message.text}\n                </Message>\n              ))}\n            </ChatMessages>\n            <ChatInput>\n              <MessageInput\n                type=\"text\"\n                placeholder=\"Share your experience, strength, and hope...\"\n                value={newMessage}\n                onChange={(e) => setNewMessage(e.target.value)}\n                onKeyPress={handleKeyPress}\n              />\n              <SendButton onClick={sendMessage}>\n                <Send size={16} />\n              </SendButton>\n            </ChatInput>\n          </ChatPanel>\n        )}\n      </MainContent>\n\n      <Controls>\n        <ControlButton\n          onClick={toggleAudio}\n          active={!isAudioMuted}\n          title={isAudioMuted ? 'Unmute' : 'Mute'}\n        >\n          {isAudioMuted ? <MicOff size={20} /> : <Mic size={20} />}\n        </ControlButton>\n\n        <ControlButton\n          onClick={toggleVideo}\n          active={!isVideoMuted}\n          title={isVideoMuted ? 'Turn on camera' : 'Turn off camera'}\n        >\n          {isVideoMuted ? <VideoOff size={20} /> : <Video size={20} />}\n        </ControlButton>\n\n        <ControlButton\n          onClick={toggleScreenShare}\n          active={isScreenSharing}\n          title={isScreenSharing ? 'Stop sharing' : 'Share screen'}\n        >\n          <Monitor size={20} />\n        </ControlButton>\n\n        <ControlButton\n          onClick={() => setShowChat(!showChat)}\n          active={showChat}\n          title=\"Toggle chat\"\n        >\n          <MessageSquare size={20} />\n        </ControlButton>\n\n        <ControlButton\n          onClick={openShareModal}\n          title=\"Share room link\"\n        >\n          <Share2 size={20} />\n        </ControlButton>\n\n        <ControlButton\n          onClick={leaveRoom}\n          className=\"leave\"\n          title=\"Leave room\"\n        >\n          <Phone size={20} />\n        </ControlButton>\n      </Controls>\n\n      {showShareModal && (\n        <ShareModal onClick={closeShareModal}>\n          <ShareModalContent onClick={(e) => e.stopPropagation()}>\n            <ShareModalHeader>\n              <ShareModalTitle>Share Meeting</ShareModalTitle>\n              <CloseModalButton onClick={closeShareModal}>×</CloseModalButton>\n            </ShareModalHeader>\n            \n            <ShareSection>\n              <ShareLabel>Meeting Link</ShareLabel>\n              <ShareInputContainer>\n                <ShareInput\n                  type=\"text\"\n                  value={getShareLink()}\n                  readOnly\n                />\n                <CopyButton\n                  onClick={copyToClipboard}\n                  disabled={linkCopied}\n                >\n                  {linkCopied ? (\n                    <>\n                      <Check size={16} />\n                      Copied!\n                    </>\n                  ) : (\n                    <>\n                      <Copy size={16} />\n                      Copy\n                    </>\n                  )}\n                </CopyButton>\n              </ShareInputContainer>\n            </ShareSection>\n\n            <ShareInstructions>\n              <ShareInstructionsText>\n                <strong>How to invite others:</strong><br />\n                1. Copy the meeting link above<br />\n                2. Share it via text, email, or any messaging app<br />\n                3. Recipients can click the link to join the meeting<br />\n                4. They'll be prompted to enter their name before joining\n              </ShareInstructionsText>\n            </ShareInstructions>\n          </ShareModalContent>\n        </ShareModal>\n      )}\n\n      {/* Name Entry Modal */}\n      {showNameModal && (\n        <NameModal>\n          <NameModalContent>\n            <NameModalHeader>\n              <NameModalTitle>Join CMA Meeting</NameModalTitle>\n              <NameModalSubtitle>\n                Please enter your name to join the meeting\n              </NameModalSubtitle>\n            </NameModalHeader>\n            \n            <NameInput\n              type=\"text\"\n              placeholder=\"Enter your name\"\n              value={tempUserName}\n              onChange={(e) => setTempUserName(e.target.value)}\n              onKeyPress={handleNameKeyPress}\n              autoFocus\n            />\n            \n            <NameModalButton\n              onClick={handleNameSubmit}\n              disabled={!tempUserName.trim()}\n            >\n              Join Meeting\n            </NameModalButton>\n          </NameModalContent>\n        </NameModal>\n      )}\n    </Container>\n  );\n};\n\nexport default VideoRoom;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}